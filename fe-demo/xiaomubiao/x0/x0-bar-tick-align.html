<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="utf-8">
    <title>é€šç”¨æŸ±çŠ¶å›¾</title>
    <!--
    2020-10-13 å»ºç«‹
    -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat/dist/ecStat.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/dataTool.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>
    <!--<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=xfhhaTThl11qYVrqLZii6w8qE5ggnhrY&__ec_v__=20190126"></script>-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/bmap.min.js"></script>
    <script src="../../config/config.js"></script>
    <script src="../../js/commonUtil.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <!-- 2020-06-15 ä»¥æ ‡ç­¾å¼•å…¥æ–¹å¼ä½¿ç”¨ element-ui okçš„ ðŸ˜¸ -->
    <!-- å¼•å…¥ç»„ä»¶åº“ -->
    <script src="https://cdn.bootcdn.net/ajax/libs/element-ui/2.13.2/index.js"></script>

    <!-- å¼•å…¥æ ·å¼ -->
    <!--<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
    <link href="https://cdn.bootcdn.net/ajax/libs/element-ui/2.13.2/theme-chalk/index.css" rel="stylesheet">
    <!--<link href="../../../css/indexV1.css" rel="stylesheet">-->
</head>
<body style="height: 100%; margin: 10px">
<div id="app1" style="background-color: orange">

    <el-row :gutter="20" class="center">
        <el-col :span="6">
            <div>
                ç”¨æˆ·ï¼š
                <el-select v-model="userId" placeholder="è¯·é€‰æ‹©ç”¨æˆ·" @change="listMatterLogV()">
                    <el-option
                            v-for="item in users"
                            :key="item.id"
                            :label="item.nick"
                            :value="item.id">
                    </el-option>
                </el-select>
            </div>
        </el-col>
        <el-col :span="6">
            ä¸€çº§äº‹ä»¶ç±»åž‹ï¼š
            <el-select v-model="mTypeCode" placeholder="è¯·é€‰æ‹©äº‹ä»¶ç±»åž‹" @change="mTypeChangeV()">
                <el-option
                        v-for="item in mTypes"
                        :key="item.code"
                        :label="item.name"
                        :value="item.code">
                </el-option>
            </el-select>
        </el-col>
        <el-col :span="6">
            äºŒçº§äº‹ä»¶ç±»åž‹ï¼š
            <el-select v-model="subTypeCode" placeholder="è¯·é€‰æ‹©äºŒçº§äº‹ä»¶ç±»åž‹" @change="listMatterLogV()">
                <el-option
                        v-for="item in subTypes"
                        :key="item.code"
                        :label="item.name"
                        :value="item.code">
                </el-option>
            </el-select>
        </el-col>
        <el-col :span="6">
            <div>ä¸‡é‡Œé›ªé£˜</div>
        </el-col>
    </el-row>
</div>

<div id="container" style="height: 96%;width: 96%"></div>

</body>


<script type="text/javascript">
    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    var app = {};
    option = null;

    option = {
        title: {
            text: 'é€šç”¨æŸ±çŠ¶å›¾',
            subtext: ''
        },
        color: ['#3398DB'],
        tooltip: {
            trigger: 'axis',
            axisPointer: {            // åæ ‡è½´æŒ‡ç¤ºå™¨ï¼Œåæ ‡è½´è§¦å‘æœ‰æ•ˆ
                type: 'shadow'        // é»˜è®¤ä¸ºç›´çº¿ï¼Œå¯é€‰ä¸ºï¼š'line' | 'shadow'
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: [
            {
                type: 'category',
                data: [],
                axisTick: {
                    alignWithLabel: true
                }
            }
        ],
        yAxis: [
            {
                type: 'value'
            }
        ],
        series: [
            {
                name: 'æ•°é‡',
                type: 'bar',
                barWidth: '60%',
                data: []
            }
        ]
    };

    if (option && typeof option === "object") {
        myChart.setOption(option, true);
    }

    listMatterLog();

    function listMatterLog(userId, mTypeCode, subTypeCode) {
        if (!userId) {
            userId = 1;
        }
        if (!mTypeCode) {
            mTypeCode = 3;
        }
        if (!subTypeCode) {
            subTypeCode = 0;
        }
        // let ajaxData = [];
        var url = listMatterLogUrl + '?mType=' + mTypeCode + '&userId=' + userId + '&subType=' + subTypeCode;
        var date = new Date();
        date.setMonth(date.getMonth() - 6);
        url = url + '&happenTimeStart=' + date.getTime()
        $.ajax({
            url: url,
            // url: 'http://localhost:63342/matter_log/list',
            async: true,
            type: 'get',
            dataType: 'json',
            success: function (resp) {
                // sleep(5000)
                // vm.$set('peoples', data.result);
                console.log('ajax matter_log/list ', resp)
                // ajaxData = resp
                let data = resp.data;
                drawChart(data)
                console.log('jie shu')
            },
            error: function (xhr, errorType, error) {
                alert('Ajax request error, errorType: ' + errorType + ', error: ' + error);
            }
        });
    }

    /**
     * ç”»å›¾è¡¨
     *
     * @param metaData
     */
    function drawChart(metaData) {
        console.log('metaData: ', metaData)
        let xData = []
        let reachAmounts = []
        if (metaData && metaData.length > 0) {
            for (let i = 0; i < metaData.length; i++) {
                var matterLog = metaData[i];
                // console.log('matterLog: ', matterLog);
                var reachAmount = matterLog.reachAmount;
                // moneyç›¸å…³åˆ†è½¬å…ƒ
                if (matterLog.mtype == 1) {
                    // console.log('fen zhuan yuan');
                    reachAmount = reachAmount / 100;
                }
                xData.push(metaData[i].happenDate);
                reachAmounts.push(reachAmount)
            }
        }
        xData.reverse()
        reachAmounts.reverse()
        myChart.setOption({
            //åŠ è½½æ•°æ®å›¾è¡¨
            xAxis: [
                {
                    type: 'category',
                    data: xData,
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            series: [
                {
                    // name: 'å­¦ä¹ æ—¶é•¿(h)',
                    // type: 'bar',
                    // barWidth: '40%',
                    data: reachAmounts
                }
            ]
        });
    }

    var app = new Vue({
        el: '#app1',
        data: {
            message: 'Hello Vue! lalalala 890',
            url: listMatterLogUrl,
            strList: list,
            users: confUsers,
            mTypes: mTypes,
            subTypes: [
                {code: 0, name: 'é»˜è®¤'}
            ],
            userId: 1,
            mTypeCode: 3,
            subTypeCode: 0
        },
        created: function () {
            // `this` æŒ‡å‘ vm å®žä¾‹
            console.log('a is: 666');
            // f() å¥½ä½¿
            this.listMatterLogV();
            this.mTypeChangeV();
        },
        methods: {
            listMatterLogV() {
                listMatterLog(this.userId, this.mTypeCode, this.subTypeCode)
            },
            getSubTypes(mTypeCode) {
                console.log('mTypeCode:', mTypeCode)
                switch (mTypeCode) {
                    case 1:
                        return [
                            {code: 0, name: '2020å¹´è¿˜æ¬¾è®¡åˆ’-é»˜è®¤'},
                            {code: 1, name: 'ç´¯è®¡å·²è¿˜æ¬¾é‡‘é¢'}
                        ];
                    case 3:
                        return [
                            {code: 0, name: 'é»˜è®¤è¿åŠ¨-æ­¥æ•°'},
                            {code: 1, name: 'è·‘æ­¥é‡Œç¨‹'}
                        ];
                    case 6:
                        return [
                            {code: 0, name: 'ç†å‘'},
                            {code: 1, name: 'drink'}
                        ];
                    default:
                        return [
                            {code: 0, name: 'é»˜è®¤000'}
                        ];
                }
            },
            mTypeChangeV() {
                this.subTypes = this.getSubTypes(this.mTypeCode);
                this.subTypeCode = 0;
                this.listMatterLogV();
            }
        }
    });

</script>
</html>
